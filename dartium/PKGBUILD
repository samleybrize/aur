# Maintainer: Samleybrize <stephen.berquet at gmail dot com>
pkgname=dartium
pkgver=37.0.2062.120
pkgrel=1
pkgdesc="Chromium-based browser that includes the Dart virtual machine"
arch=(i686 x86_64)
url="http://www.dartlang.org/dartium/"
license=('BSD')
depends=('libudev.so.0' 'libgcrypt15' 'gconf')
optdepends=()
makedepends=(unzip)
provides=('dartium')
conflicts=('dartium-bin')
replaces=()
install=
noextract=()

if [[ ${CARCH} = x86_64 ]]; then
	source=("http://storage.googleapis.com/dart-archive/channels/stable/release/latest/dartium/dartium-linux-x64-release.zip"
		"dartium.desktop")
	md5sums=('520d779fbc765b453c06a1b942ea3b1d'
		'd72c00627052d3c0d8a3ad581b0fe4e8')
else
	source=("http://storage.googleapis.com/dart-archive/channels/stable/release/latest/dartium/dartium-linux-ia32-release.zip"
		"dartium.desktop")
	md5sums=('79226791d1c4d6f182d68a0f94421bab'
		'd72c00627052d3c0d8a3ad581b0fe4e8')
fi

package(){
	if [[ ${CARCH} = x86_64 ]]; then
		_from=dartium-lucid64-full-stable-41096.0
	else
		_from=dartium-lucid32-full-stable-41096.0
	fi

	mkdir -p ${pkgdir}/opt ${pkgdir}/usr/bin ${pkgdir}/usr/share/pixmaps
	find ${srcdir}/${_from} -perm -u+x -exec chmod +x '{}' +
	find ${srcdir}/${_from} -perm -u+r -exec chmod +r '{}' +
	find ${srcdir}/${_from} -perm -u+w -exec chmod +w '{}' +
	cp -r ${srcdir}/${_from} ${pkgdir}/opt/${pkgname}

	ln -s /opt/${pkgname}/chrome ${pkgdir}/usr/bin/dartium

	install -D -m 0644 ${srcdir}/${_from}/product_logo_48.png "${pkgdir}/usr/share/pixmaps/${pkgname}.png"
	install -D -m 0644 dartium.desktop "${pkgdir}/usr/share/applications/dartium.desktop"
}
